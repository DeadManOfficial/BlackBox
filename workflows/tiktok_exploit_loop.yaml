# BlackBox - TikTok Exploitation Loop Workflow
# =============================================
# Automated vulnerability chain exploitation
# Target: TikTok (HackerOne Bug Bounty Program)

name: "TikTok Exploit Loop"
version: "1.0.0"
description: "Systematic exploitation workflow for TikTok vulnerabilities"
authorization: "HackerOne Bug Bounty Program - Safe Harbor"

scope_file: "../targets/tiktok/scope.yaml"
findings_dir: "../targets/tiktok/findings"

# Attack Chain Methodology
phases:
  # ==========================================================================
  # PHASE 1: DATA HARVESTING
  # ==========================================================================
  P1_HARVEST:
    name: "Data Harvesting"
    description: "Extract data from public endpoints for attack chaining"

    targets:
      - endpoint: "/node/share/discover"
        purpose: "Harvest secUids for IDOR attacks"
        output: "leaked_secuids.json"

      - endpoint: "/@{username}"
        purpose: "Extract video IDs from user pages"
        output: "video_ids.json"

    findings:
      - type: "data_leak"
        severity: "medium"
        details: "secUid, userId, follower counts exposed without auth"

  # ==========================================================================
  # PHASE 2: SIGNATURE BYPASS
  # ==========================================================================
  P2_BYPASS:
    name: "X-Bogus Signature Bypass"
    description: "Test API endpoints without required signatures"

    targets:
      - endpoint: "/api/comment/list/"
        params: ["aweme_id", "count", "cursor"]
        bypass_confirmed: true

      - endpoint: "/api/user/list_following/"
        params: ["secUid", "count"]
        bypass_confirmed: true

      - endpoint: "/api/user/list_follower/"
        params: ["secUid", "count"]
        bypass_confirmed: true

    findings:
      - type: "auth_bypass"
        severity: "medium"
        details: "X-Bogus signature not enforced on multiple endpoints"

  # ==========================================================================
  # PHASE 3: INTERNAL API ENUMERATION
  # ==========================================================================
  P3_INTERNAL:
    name: "Internal API Discovery"
    description: "Enumerate debug and internal endpoints"

    targets:
      accessible:
        - "/api/debug"
        - "/api/debug/status"
        - "/api/debug/info"
        - "/api/debug/health"
        - "/api/debug/metrics"
        - "/api/debug/logs"
        - "/api/debug/vars"
        - "/api/debug/user"
        - "/api/internal"
        - "/api/internal/status"
        - "/api/v2/debug"

      rate_limited:
        - "/api/debug/config"
        - "/api/debug/env"
        - "/api/debug/trace"
        - "/api/debug/pprof"
        - "/api/debug/video"

    findings:
      - type: "info_disclosure"
        severity: "low-medium"
        details: "Debug/internal endpoints accessible, need parameter fuzzing"

  # ==========================================================================
  # PHASE 4: ATTACK CHAINING
  # ==========================================================================
  P4_CHAIN:
    name: "Attack Chaining"
    description: "Combine findings for deeper exploitation"

    chains:
      - name: "SecUid -> Following List"
        steps:
          - harvest: "/node/share/discover"
          - extract: "secUid"
          - chain_to: "/api/user/list_following/?secUid={secUid}"

      - name: "VideoId -> Comments -> UserData"
        steps:
          - harvest: "/@{user}"
          - extract: "video_id"
          - chain_to: "/api/comment/list/?aweme_id={video_id}"
          - extract: "commenter_uid"
          - chain_to: "/api/user/detail/?uniqueId={uid}"

  # ==========================================================================
  # PHASE 5: DEEP EXPLOITATION
  # ==========================================================================
  P5_EXPLOIT:
    name: "Deep Exploitation"
    description: "Parameter fuzzing, rate limit bypass, privilege escalation"

    techniques:
      - name: "Rate Limit Bypass"
        methods:
          - "Header rotation (X-Forwarded-For)"
          - "Cookie rotation"
          - "Timing attacks"
          - "IP rotation via proxy"

      - name: "Parameter Injection"
        targets:
          - "aweme_id (SQL injection, IDOR)"
          - "secUid (format manipulation)"
          - "count (integer overflow)"
          - "cursor (pagination abuse)"

# Automation Scripts
scripts:
  - path: "../targets/tiktok/scripts/real_pentest.py"
    purpose: "Main exploitation framework"

  - path: "../targets/tiktok/scripts/oauth_flow.py"
    purpose: "OAuth token acquisition"

# Task Tracking
tasks:
  pending:
    - "Exploit X-Bogus bypass on comment endpoint"
    - "Exploit X-Bogus bypass on following list"
    - "Exploit public data leak via node/share/discover"
    - "Exploit /api/debug/ endpoint"
    - "Missing security headers"
    - "Exploit /api/internal/* endpoints"
    - "Bypass rate limiting on debug endpoints"

# Loop Control
loop:
  trigger: "finding_discovered"
  action: "add_to_tasks"
  behavior: "return_and_dig_deeper"
  max_depth: 10
